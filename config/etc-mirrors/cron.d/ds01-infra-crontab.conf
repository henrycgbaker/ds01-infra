# Cron jobs for DS01 Infrastructure Monitoring
# Deploy to: /etc/cron.d/ds01-infra
# Source: /opt/ds01-infra/config/etc-mirrors/cron.d/ds01-infra-crontab.conf
# Do: sudo cp /opt/ds01-infra/config/etc-mirrors/cron.d/ds01-infra-crontab.conf /etc/cron.d/ds01-infra


# All scripts output to /var/log/ds01-infra/cron/cron.log
# Individual scripts log to their respective subdirectories

# DS01 Infrastructure Monitoring
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# Collect metrics every 5 minutes
*/5 * * * * /opt/ds01-infra/scripts/monitoring/collect-gpu-metrics.sh >> /var/log/ds01-infra/cron/cron.log 2>&1
*/5 * * * * /opt/ds01-infra/scripts/monitoring/collect-cpu-metrics.sh >> /var/log/ds01-infra/cron/cron.log 2>&1
*/5 * * * * /opt/ds01-infra/scripts/monitoring/collect-memory-metrics.sh >> /var/log/ds01-infra/cron/cron.log 2>&1
*/5 * * * * /opt/ds01-infra/scripts/monitoring/collect-disk-metrics.sh >> /var/log/ds01-infra/cron/cron.log 2>&1
*/5 * * * * /opt/ds01-infra/scripts/monitoring/collect-container-metrics.sh >> /var/log/ds01-infra/cron/cron.log 2>&1

# Daily report at 23:55
55 23 * * * /opt/ds01-infra/scripts/monitoring/compile-daily-report.sh >> /var/log/ds01-infra/cron/cron.log 2>&1

# Weekly audits - Sunday 2am and 3am
0 2 * * 0 /opt/ds01-infra/scripts/monitoring/audit-system.sh >> /var/log/ds01-infra/cron/cron.log 2>&1
0 3 * * 0 /opt/ds01-infra/scripts/monitoring/audit-docker.sh >> /var/log/ds01-infra/cron/cron.log 2>&1

# Weekly maintenance - Sunday 3am
0 3 * * 0 /opt/ds01-infra/scripts/maintenance/setup-scratch-dirs.sh >> /var/log/ds01-infra/cron/cron.log 2>&1

# Monthly cleanup - 1st of month at 4am
0 4 1 * * find /scratch -type f -mtime +45 -delete >> /var/log/ds01-infra/cron/cron.log 2>&1
5 4 1 * * find /scratch -type d -empty -delete >> /var/log/ds01-infra/cron/cron.log 2>&1

# build this out more

# Clean up Docker images
#COME BACK TO: 0 4 1 * * datasciencelab docker image prune -f >> /var/log/ds01-infra/cron/cron.log 2>&1



