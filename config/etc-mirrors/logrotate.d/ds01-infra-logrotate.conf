# Logrotate configuration for DS01 Infrastructure
# Deploy to: /etc/logrotate.d/ds01-infra
# Source: /opt/ds01-infra/config/etc-mirrors/logrotate.d/ds01-infra
# Do: sudo cp /opt/ds01-infra/config/etc-mirrors/logrotate.d/ds01-infra-logrotate.conf /etc/logrotate.d/ds01-infra

# Raw metrics logs (high frequency, large volume)
/var/log/ds01-infra/metrics/*/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0644 datasciencelab datasciencelab
    dateext
    dateformat -%Y%m%d
    maxage 90
    sharedscripts
    postrotate
        # Optional: trigger any post-rotation tasks
        # /opt/ds01-infra/scripts/monitoring/post-rotation-cleanup.sh > /dev/null 2>&1 || true
    endscript
}

# Daily reports (low frequency, keep longer)
/var/log/ds01-infra/reports/daily/*.md {
    monthly
    rotate 12
    compress
    delaycompress
    missingok
    notifempty
    create 0644 datasciencelab datasciencelab
    dateext
    dateformat -%Y%m
    maxage 365
}

# System audits (weekly, detailed)
/var/log/ds01-infra/audits/system/*.md {
    weekly
    rotate 26
    compress
    delaycompress
    missingok
    notifempty
    create 0644 datasciencelab datasciencelab
    dateext
    dateformat -%Y%m%d
    maxage 180
}

# Docker audits (weekly)
/var/log/ds01-infra/audits/docker/*.md {
    weekly
    rotate 26
    compress
    delaycompress
    missingok
    notifempty
    create 0644 datasciencelab datasciencelab
    dateext
    dateformat -%Y%m%d
    maxage 180
}

# Maintenance logs
/var/log/ds01-infra/maintenance/*/*.log {
    weekly
    rotate 8
    compress
    delaycompress
    missingok
    notifempty
    create 0644 datasciencelab datasciencelab
    dateext
    dateformat -%Y%m%d
    maxage 60
}

# Cron logs
/var/log/ds01-infra/cron/cron.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 0644 datasciencelab datasciencelab
    dateext
    dateformat -%Y%m%d
}
